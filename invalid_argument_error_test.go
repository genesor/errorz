// Code generated by http://github.com/genesor/errorz (v1.0.0). DO NOT EDIT.

package errorz

import (
	"errors"
	"fmt"
	"net/http"
	"testing"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

func TestInvalidArgumentError(t *testing.T) {
	t.Run("AsErrorz", func(t *testing.T) {
		err, isErrorz := AsErrorz(NewInvalidArgumentError("code", "key"))
		require.True(t, isErrorz)

		assert.EqualError(t, err, "key")
		assert.Equal(t, "key", err.Key)
		assert.Equal(t, "code", err.Code)
		assert.Nil(t, err.Cause)
		assert.Equal(t, http.StatusUnprocessableEntity, err.HTTPCode)
	})

	t.Run("no code", func(t *testing.T) {
		err := NewInvalidArgumentError("", "some error content")
		require.EqualError(t, err, "some error content")

		res := errors.Is(err, &InvalidArgumentError{})
		require.True(t, res)

		err2 := fmt.Errorf("wrap2: %w", fmt.Errorf("wrap1: %w", err))
		res = errors.Is(err2, &InvalidArgumentError{})
		require.True(t, res)

		res = IsInvalidArgumentError(err2)
		require.True(t, res)

		err3, ok := AsInvalidArgumentError(err)
		require.True(t, ok)
		require.Equal(t, "some error content", err3.Key)

		err4, ok := AsInvalidArgumentError(err2)
		require.True(t, ok)
		require.Equal(t, "some error content", err4.Key)

		err5, ok := AsInvalidArgumentError(fmt.Errorf("not a InvalidArgumentError"))
		require.False(t, ok)
		require.Nil(t, err5)

		err6 := errors.New("base error")
		err7 := WrapWithInvalidArgumentError(err6, "", "some error content")
		require.EqualError(t, err7, "some error content: base error")

		require.True(t, errors.Is(err7, &InvalidArgumentError{}))
		require.True(t, errors.Is(err7, &InvalidArgumentError{}))
		require.True(t, IsInvalidArgumentError(err7))

		err8, ok := AsInvalidArgumentError(err7)
		require.True(t, ok)
		require.Equal(t, "some error content", err8.Key)

		err9 := new(InvalidArgumentError)
		require.True(t, errors.As(err7, err9))
		require.Equal(t, "some error content", err9.Key)
	})

	t.Run("with code", func(t *testing.T) {
		err, ok := AsInvalidArgumentError(NewInvalidArgumentError("awesome_code", "error"))
		require.True(t, ok)
		require.Equal(t, "awesome_code", err.Code)
	})

	t.Run("with formatting", func(t *testing.T) {
		err, ok := AsInvalidArgumentError(NewInvalidArgumentErrorf("", "error %d", 1))
		require.True(t, ok)
		require.Empty(t, err.Code)
		require.Equal(t, "error 1", err.Key)

		err2, ok := AsInvalidArgumentError(WrapWithInvalidArgumentErrorf(err, "", "error %d", 2))
		require.True(t, ok)
		require.Empty(t, err2.Code)
		require.Equal(t, "error 2", err2.Key)
		require.Equal(t, err, err2.Cause)
	})
}
